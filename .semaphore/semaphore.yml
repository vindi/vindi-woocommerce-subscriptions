version: v1.0
name: vindi-woocommerce-subscriptions
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804
blocks:
  - name: Setup
    task:
      jobs:
        - name: Setup
          commands:
            - docker network create webproxy && echo "127.0.0.1  vindi.local" >> /etc/hosts
            - docker-compose up -d && sleep 20
            - 'docker cp wordpress_db:/docker-entrypoint-initdb.d/wordpress.sql dump.sql'
            - 'docker cp dump.sql vindi.local:/var/www/html/wp-content/plugins/vindi-woocommerce-subscriptions/tests/_data/'
            - chromedriver --url-base=/wd/hub & echo "API_KEY=digite aqui a chave API" >> ./.env
            - 'docker cp .env vindi.local:/var/www/html/wp-content/plugins/vindi-woocommerce-subscriptions/'
  - name: Test
    task:
      jobs:
        - name: Test
          commands:
            - docker exec -it vindi.local composer test
